version: 3

tasks:
  build:
    generates:
      - dist/ve.exe
    sources:
      - go.mod
      - go.sum
      - "**/*.go"
      - "internal/web/static/**/*"
    cmd: go build -tags release -o dist/tyr.exe main.go

  build:dev:
    generates:
      - dist/tmp/tmp.exe
    env:
      #      CGO_ENABLED: '0'
      GORACE: halt_on_error=1
    sources:
      - .env
      - go.mod
      - go.sum
      - "**/*.go"
      - "internal/web/static/**/*"
      - "**/*.json"
    cmd: go build -tags assert -o dist/tmp/tmp.exe main.go

  dev:
    watch: true
    deps:
      - build:dev
    dotenv:
      - .env
    cmds:
      - cp dist/tmp/tmp.exe dist/tmp/server.exe
      - dist/tmp/server.exe --debug --web 127.0.0.1:8002 --config-file ./config.toml
  #
  #  dev:release:
  #    watch: true
  #    deps:
  #      - build
  #    cmds:
  #      - cp dist/tyr.exe dist/server.exe
  #      - dist/server.exe --web 127.0.0.1:8002 --config-file ./config.toml
  lint: golangci-lint run
